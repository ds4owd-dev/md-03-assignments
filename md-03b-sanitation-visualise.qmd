---
title: "Data transformation with dplyr"
subtitle: "And make a plot"
format: html
editor_options: 
  chunk_output_type: console
editor: visual
---

```{r}
#| label: load-packages
library(readr)
library(dplyr)
library(ggplot2)
library(ggthemes)
```

## Import

In this exercise we use data of the UNICEF/WHO Joint Monitoring Programme (JMP) for Water Supply, Sanitation and Hygiene (WASH). The data is available at <https://washdata.org/data>.

The data set `jmp_wld_sanitation_long` is available in the `data` folder of this repository. The data set is in long format and contains the following variables:

-   `name`: country name
-   `iso3`: ISO3 country code
-   `year`: year of observation
-   `region_sdg`: SDG region
-   `residence`: residence type (national, rural, urban)
-   `varname_short`: short variable name (JMP naming convention)
-   `varname_long`: long variable name (JMP naming convention)

We use the `read_csv()` function to import the data set into R.

```{r}
sanitation <- read_csv("data/jmp_wld_sanitation_long.csv")
```

### Task 1.1

1.  Use the `glimpse()` function to get an overview of the data set.
2.  How many variables are in the data set?

```{r}
glimpse(sanitation)
```

### Task 1.2

1.  Use the `count()` function with varname_short and varname_long to identify the definitions of the levels in these variables.

```{r}
sanitation |> 
  count(varname_short, varname_long)
```

### Task 1.3

1.  Use the `filter()` function to create a subset of the data set that only contains observations:

-   for the country you live/work
-   for the year 2000 and 2020
-   for all variables that are not "safely managed sanitation services"

2.  Store the result as a new object in your environment with a name of your choice.

```{r}
sanitation_uga <- sanitation |> 
  filter(iso3 == "UGA",
         year %in% c(2000, 2020), 
         varname_short != "san_sm")
```

### Task 1.4

1.  Use the `ggplot()` function to create a bar plot with `geom_col()` for the data you created in Task 1.3.

2.  Use the `aes()` function to map the `residence` variable to the x-axis, the `percent` variable to the y-axis, and the `varname_long` variable to the fill aesthetic.

3. Use `facet_wrap()` to create a separate plot for each year.

```         
geom_text(aes(label = round(percent, 1)), 
          position = position_stack(vjust = 0.5),
          size = 3) 
```

```{r}
ggplot(data = sanitation_uga,
       mapping = aes(x = residence, 
                     y = percent, 
                     fill = varname_long)) +
  geom_col() +
  facet_wrap(~year) +
  geom_text(aes(label = round(percent, 1)), 
          position = position_stack(vjust = 0.5),
          size = 3) 
```

### Task 1.5

1. Look at the plot that you created. What do you notice about the order of the bars / order of the legend?
2. What would you want to change?
3. Why did we remove "safely managed sanitation services" from the data set in Task 1.3?

